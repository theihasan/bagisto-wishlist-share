name: Basic Package Check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  basic-check:
    runs-on: ubuntu-22.04
    name: Basic Package Validation

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Check PHP syntax
      run: |
        echo "Checking PHP syntax in all PHP files..."
        syntax_errors=0
        for file in $(find src tests -name "*.php" 2>/dev/null || true); do
          if [ -f "$file" ]; then
            echo "Checking $file..."
            if ! php -l "$file" > /dev/null 2>&1; then
              echo "âœ— Syntax error in $file"
              php -l "$file"
              syntax_errors=1
            fi
          fi
        done
        
        if [ $syntax_errors -eq 0 ]; then
          echo "âœ“ No PHP syntax errors found"
        else
          echo "âœ— PHP syntax errors found"
          exit 1
        fi

    - name: Validate composer.json
      run: |
        if command -v composer &> /dev/null; then
          composer validate --strict
        else
          echo "Composer not available, checking JSON syntax manually"
          php -r "json_decode(file_get_contents('composer.json'), true, 512, JSON_THROW_ON_ERROR); echo 'composer.json is valid JSON';"
        fi

    - name: Check required files exist
      run: |
        echo "Checking required files..."
        files=("README.md" "LICENSE" "composer.json" "src/Providers/WishlistShareServiceProvider.php")
        for file in "${files[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ“ $file exists"
          else
            echo "âœ— $file is missing"
            exit 1
          fi
        done

    - name: Check directory structure
      run: |
        echo "Checking directory structure..."
        dirs=("src" "src/Config" "src/Models" "src/Http" "src/Resources" "tests")
        for dir in "${dirs[@]}"; do
          if [ -d "$dir" ]; then
            echo "âœ“ $dir directory exists"
          else
            echo "âœ— $dir directory is missing"
            exit 1
          fi
        done

    - name: Package validation complete
      run: echo "ðŸŽ‰ Basic package validation passed!"